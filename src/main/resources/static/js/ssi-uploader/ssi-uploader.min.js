(function(f,k){"object"===typeof module&&module.exports?module.exports=k(require("jquery")):k(f.jQuery)})(this,function(f){var k=function(a,c){this.options=c;this.$element="";this.language=G[this.options.locale];this.uploadList=[];this.totalProgress=[];this.toUpload=[];this.imgNames=[];this.currentListLength=this.inProgress=this.pending=this.abortedWithError=this.aborted=this.successfulUpload=this.totalFilesLength=0;this.init(a)};k.prototype.init=function(a){f(a).addClass("ssi-uploadInput").after(this.$element=
f('<div class="ssi-uploader">'));a=f('<span class="ssi-InputLabel"><button class="ssi-button success">'+this.language.chooseFiles+"</button></span>").append(a);var c=f('<button id="ssi-uploadBtn" class="ssi-button success ssi-hidden" ><span class="ssi-btnIn">'+this.language.upload+'&nbsp;</span><div id="ssi-up_loading" class="ssi-btnIn"></div></button>'),e=f('<button id="ssi-clearBtn" class="ssi-hidden ssi-button info" >'+this.language.clear+"</button>"),b=f('<button id="ssi-abortBtn" class="ssi-button error ssi-cancelAll ssi-hidden" ><span class="inBtn">'+
this.language.abort+" </span></button>");this.$element.append(f('<div class="ssi-buttonWrapper">').append(a,b,c,e));var d;if(this.options.preview)d=f('<div id="ssi-previewBox" class="ssi-uploadBox ssi-previewBox '+(this.options.dropZone?'ssi-dropZonePreview ssi-dropZone"><div id="ssi-DropZoneBack">'+this.language.drag+"</div>":'">')+"</div>"),this.$element.append(d);else{this.$element.addClass("ssi-uploaderNP");var l=f('<table id="ssi-fileList" class="ssi-fileList"></table>'),m=f('<span class="ssi-namePreview"></span>'),
h=f('<div id="ssi-uploadFiles" class="ssi-tooltip ssi-uploadFiles '+(this.options.dropZone?"ssi-dropZone":"")+'"><div id="ssi-uploadProgressNoPreview" class="ssi-uploadProgressNoPreview"></div></div>').append(m),k=f('<div class="ssi-uploadDetails"></div>').append(l);d=f('<div class="ssi-uploadBoxWrapper ssi-uploadBox"></div>').append(h,k);this.$element.prepend(d)}var g=this,q=a.find(".ssi-uploadInput");a.find("button").click(function(){q.trigger("click")});q.on("change",function(){g.toUploadFiles(this.files);
q.val("")});g.options.dropZone&&(d.on("drop",function(a){a.preventDefault();d.removeClass("ssi-dragOver");g.toUploadFiles(a.originalEvent.dataTransfer.files)}),d.on("dragover",function(a){a.preventDefault();d.addClass("ssi-dragOver");return!1}),d.on("dragleave",function(a){a.preventDefault();d.removeClass("ssi-dragOver");return!1}));g.options.preview||h.click(function(){1<g.currentListLength&&k.toggleClass("ssi-uploadBoxOpened")});e.click(function(){g.clear()});var r;d.on("mouseenter",".ssi-statusLabel",
function(a){a=f(a.currentTarget);var b=a.attr("data-status");if(b&&""!==b){var c="35";a.hasClass("ssi-noPreviewSubMessage")&&(c=0);r=f('<div class="ssi-infoTooltip">'+b+"</div>").appendTo(g.$element).css({top:a.position().top-c,left:a.position().left-5}).fadeIn("slow")}});d.on("mouseleave",".ssi-statusLabel",function(){r&&r.remove()});d.on("click",".ssi-removeBtn",function(a){var b=f(a.currentTarget);a=b.data("delete");g.pending--;g.currentListLength--;0===g.pending&&c.prop("disabled",!0);g.options.preview?
b.parents("table.ssi-imgToUploadTable").remove():(b=b.parents("tr.ssi-toUploadTr"),m.html(g.currentListLength+" files"),b.prev().remove(),b.remove(),1===g.currentListLength&&B(g));g.toUpload[a]=null;g.imgNames[a]=null;0===g.currentListLength&&(g.options.dropZone||d.removeClass("ssi-uploadNoDropZone"),e.addClass("ssi-hidden"),c.addClass("ssi-hidden"))});d.on("click",".ssi-abortUpload",function(a){a=f(a.currentTarget).data("delete");g.abort(a)});c.click(function(){g.uploadFiles()});b.click(function(){g.abortAll()})};
k.prototype.abortAll=function(){for(var a=0;a<this.uploadList.length;a++)"object"===typeof this.uploadList[a]&&this.abort(a)};k.prototype.toUploadFiles=function(a){function c(){var a=e.totalFilesLength+e.pending;0===a&&(e.options.preview&&(e.options.dropZone||g.addClass("ssi-uploadNoDropZone")),m.removeClass("ssi-hidden"),h.removeClass("ssi-hidden"));h.prop("disabled",!1);e.toUpload[a]=n;var c=n.name,d=c.getExtension();e.imgNames[a]=c;if(e.options.preview){var r=function(b){return'<table class="ssi-imgToUploadTable ssi-pending"><tr><td class="ssi-upImgTd">'+
b+'</td></tr><tr><td><div id="ssi-uploadProgress'+a+'" class="ssi-hidden ssi-uploadProgress"></div></td></tr><tr><td><button data-delete="'+a+'" class=" ssi-button error ssi-removeBtn"><span class="trash10 trash"></span></button></td></tr><tr><td>'+u(c,d,15)+"</td></tr></table>"};if("image"==n.type.split("/")[0]){m.prop("disabled",!0);h.prop("disabled",!0);var f=new FileReader;f.onload=function(){l+=r('<img class="ssi-imgToUpload" src=""/><i class="fa-spin fa fa-spinner fa-pulse"></i>');q[a]=f.result;
b++;v===b&&(g.append(l),m.prop("disabled",!1),h.prop("disabled",!1),setTimeout(function(){for(var a=0;a<q.length;a++)null!==q[a]&&(g.find("#ssi-uploadProgress"+a).parents("table.ssi-imgToUploadTable").find(".ssi-imgToUpload").attr("src",q[a]).next().remove(),q[a]=null);q=[]},10),l="",v=[])};f.readAsDataURL(n)}else q[a]=null,g.append(r('<div class="document-item" href="test.mov" filetype="'+d+'"><span class = "fileCorner"></span></div>')),b++}else e.$element.find(".ssi-namePreview").html(0===a?u(c,
d,13):e.currentListLength+1+" "+e.language.files),k.append('<tr class="ssi-space"><td></td></tr><tr class="ssi-toUploadTr ssi-pending"><td><div id="ssi-uploadProgress'+a+'" class="ssi-hidden ssi-uploadProgress ssi-uploadProgressNoPre"></div><span>'+u(c,d,20)+'</span></td><td><a data-delete="'+a+'" class="ssi-button ssi-removeBtn  ssi-removeBtnNP"><span class="trash7 trash"></span></a></td></tr>')}if(!("number"===typeof this.options.maxNumberOfFiles&&this.inProgress+this.pending>=this.options.maxNumberOfFiles)){var e=
this,b=0,d,l="",m=this.$element.find("#ssi-uploadBtn"),h=this.$element.find("#ssi-clearBtn"),k=this.$element.find("#ssi-fileList"),g=this.$element.find(".ssi-uploadBox"),q=[];0===this.inProgress&&0===this.pending&&this.clear();var r=[],y=[],x="",v,t=d=v=a.length;"number"===typeof this.options.maxNumberOfFiles&&t>this.options.maxNumberOfFiles-(this.inProgress+this.pending)&&(t=v=this.options.maxNumberOfFiles-(this.inProgress+this.pending));for(var w=0;w<t;w++){var n=a[w],p=n.name.getExtension();-1===
f.inArray(p,this.options.allowed)?(d>t?t++:v--,-1===f.inArray(p,r)&&r.push(p)):(n.size*Math.pow(10,-6)).toFixed(2)>this.options.maxFileSize?(d>t?t++:v--,y.push(u(n.name,p,15))):-1===f.inArray(n.name,this.imgNames)?(m.prop("disabled",!1),c(n),this.pending++,this.currentListLength++):d>t?t++:v--}a=r.length;d=y.length;0<a+d&&(0<a&&(x=this.language.extError.replaceText(r.toString().replace(/,/g,", "))),0<d&&(x+=this.language.sizeError.replaceText(y.toString().replace(/,/g,", "),this.options.maxFileSize+
"mb")),this.options.errorHandler.method(x,this.options.errorHandler.error))}};var C=function(a){var c=a.$element.find(".ssi-completed");a.successfulUpload=0;a.aborted=0;a.abortedWithError=0;a.options.preview||c.prev("tr").remove();c.remove()},D=function(a){for(var c=a.$element.find(".ssi-pending"),e=a.imgNames.length,b=0;b<e;b++)null===a.imgNames[b]&&(a.toUpload.splice(b,1),a.imgNames.splice(b,1));a.toUpload.splice(-a.pending,a.pending);a.imgNames.splice(-a.pending,a.pending);a.pending=0;a.options.preview||
c.prev("tr").remove();c.remove()};k.prototype.clear=function(a){switch(a){case "pending":D(this);break;case "completed":C(this);break;default:D(this),C(this)}a=this.$element.find("#ssi-uploadBtn");var c=this.$element.find("#ssi-clearBtn");this.currentListLength=this.inProgress+this.successfulUpload+this.aborted+this.abortedWithError+this.pending;0===this.inProgress&&(this.totalProgress=[]);0===this.currentListLength&&(c.addClass("ssi-hidden"),a.addClass("ssi-hidden"),this.totalFilesLength=0,this.options.dropZone||
this.$element.find(".ssi-uploadBox").removeClass("ssi-uploadNoDropZone"));c.prop("disabled",!0);a.prop("disabled",!0);this.options.preview||E(this)};var E=function(a){1<a.currentListLength?a.$element.find(".ssi-namePreview").html(a.currentListLength+" files"):1===a.currentListLength?B(a):(a.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened"),a.$element.find("#ssi-fileList").empty(),a.$element.find(".ssi-namePreview").empty())};k.prototype.uploadFiles=function(){function a(d,h){var k=
"table.ssi-imgToUploadTable";b.options.preview||(k="tr.ssi-toUploadTr");var g=b.$element.find("#ssi-uploadProgress"+h);g.removeClass("ssi-hidden").parents(k).removeClass("ssi-pending");k=f.extend({},{xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){if(a.lengthComputable){a=a.loaded/a.total*100;g&&g.css({width:a+"%"});b.totalProgress[h]=a;a=b.totalProgress;for(var e=0,d=0;d<a.length;d++)"number"===typeof a[d]&&(e+=a[d]);a=e/(b.inProgress+b.successfulUpload);
b.options.preview||b.$element.find("#ssi-uploadProgressNoPreview").removeClass("ssi-hidden").css({width:a+"%"});c.find("#ssi-up_loading").html(Math.ceil(a)+"%")}},!1);return a},async:!0,beforeSend:function(a){b.uploadList[h]=a;c.find("#ssi-up_loading").html('<i class="fa fa-spinner fa-pulse"></i>');if("function"===typeof b.options.beforeEachUpload)try{var e=b.options.beforeEachUpload({name:b.toUpload[h].name,type:b.toUpload[h].type,size:(b.toUpload[h].size/1024).toFixed(2)},a)}catch(d){console.log("There is an error in beforeEachUpload callback");
console.log(d);b.abortAll();return}b.$element.find("input.ssi-uploadInput").trigger("beforeEachUpload.ssi-uploader");0===a.status&&"canceled"===a.statusText&&("undefined"===typeof e&&(e=!1),b.abortedWithError++,b.abort(h,e))},type:"POST",data:d,cache:!1,contentType:!1,processData:!1,url:b.options.url,error:function(a,c){if("abort"!==c){g.addClass("ssi-canceledProgressBar");var d=b.language.error;b.abortedWithError++;b.totalProgress.splice(h,1);b.options.preview||(d='<span class="exclamation7"></span>');
z(b,h,"error",d,b.language.serverError);b.totalProgress[h]="";b.inProgress--;e.prop("disabled",!1);if("function"===typeof b.options.onEachUpload)try{b.options.onEachUpload({uploadStatus:"error",name:b.toUpload[h].name,size:(b.toUpload[h].size/1024).toFixed(2),type:b.toUpload[h].type})}catch(f){console.log("There is an error in onEachUpload callback"),console.log(f)}0===b.inProgress&&A(b);console.log(arguments);console.log(" Ajax error: "+c)}}},b.options.ajaxOptions);f.ajax(k).done(function(a,c,d){function l(a,
c){a?(w="success",k=b.language.success,n="check",b.successfulUpload++):(g.addClass("ssi-canceledProgressBar"),b.options.preview&&(k=b.language.error),m=c,b.abortedWithError++)}var k,m="",w="error",n="exclamation",p;try{p=f.parseJSON(a)}catch(u){p=a}b.options.responseValidation?(a=b.options.responseValidation,"object"===typeof a.validationKey&&"validationKey"==a.resultKey?p.hasOwnProperty(a.validationKey.success)?l(!0):l(!1,p[a.validationKey.error]):p[a.validationKey]==a.success?l(!0):l(!1,p[a.resultKey])):
200==d.status?l(!0):l(!1,p);b.options.preview||(k='<span class="'+n+'7"></span>');z(b,h,w,k,m);if("function"===typeof b.options.onEachUpload)try{b.options.onEachUpload({uploadStatus:w,name:b.toUpload[h].name,size:(b.toUpload[h].size/1024).toFixed(2),type:b.toUpload[h].type})}catch(u){console.log("There is an error in onEachUpload callback"),console.log(u)}b.$element.find("input.ssi-uploadInput").trigger("onEachUpload.ssi-uploader");b.inProgress--;e.prop("disabled",!1);0===b.inProgress&&A(b);b.uploadList[h]=
"";b.toUpload[h]="";b.imgNames[h]=""});l=h;for(l++;null===b.toUpload[l];)l++;l<b.toUpload.length&&(d=new FormData,f.each(b.options.data,function(a,b){d.append(a,b)}),d.append("files[]",b.toUpload[l]),a(d,l))}if(0<this.pending){this.$element.find("#ssi-abortBtn").removeClass("ssi-hidden");this.$element.find(".ssi-removeBtn").addClass("ssi-abortUpload").removeClass("ssi-removeBtn").children("span").removeClass("trash7 trash10 trash").addClass(this.options.preview?"ban7w":"ban7");var c=this.$element.find("#ssi-uploadBtn"),
e=this.$element.find("#ssi-clearBtn");c.prop("disabled",!0);var b=this,d=new FormData,l=this.totalFilesLength;0===this.totalFilesLength||this.options.preview||E(this);this.inProgress+=this.pending;this.totalFilesLength+=this.pending;this.pending=0;for(this.inProgress===this.currentListLength&&e.prop("disabled",!0);null===this.toUpload[l];)l++;d.append("files[]",b.toUpload[l]);f.each(this.options.data,function(a,b){d.append(a,b)});if("function"===typeof this.options.beforeUpload)try{this.options.beforeUpload()}catch(m){console.log("There is an error in beforeUpload callback");
console.log(m);b.abortAll();return}b.$element.find("input.ssi-uploadInput").trigger("beforeUpload.ssi-uploader");a(d,l)}};var z=function(a,c,e,b,d){var f="",k="table.ssi-imgToUploadTable";a.options.preview||(f="ssi-noPreviewSubMessage",k="tr.ssi-toUploadTr",1===a.currentListLength&&(a.errors=d));a=a.$element.find(".ssi-abortUpload[data-delete='"+c+"']");a.parents(k).addClass("ssi-completed");a.after(F(e,b,d,f)).remove()},F=function(a,c,e,b){return'<span class="ssi-statusLabel '+b+" "+a+'" data-status="'+
e+'">'+c+"</span>"},B=function(a){var c=a.$element.find("#ssi-fileList").find("span").html(),e=c.getExtension();a.$element.find(".ssi-uploadDetails").removeClass("ssi-uploadBoxOpened");a.$element.find(".ssi-namePreview").html(u(c,e,15))};k.prototype.abort=function(a,c){"undefined"===typeof c?(this.uploadList[a].abort(),this.totalProgress[a]="",c="Aborted",this.aborted++):"string"!==typeof c&&(c="");var e=this.language.aborted;this.options.preview||(e='<span class="ban7w"></span>');z(this,a,"error",
e,c);this.$element.find("#ssi-uploadProgress"+a).removeClass("ssi-hidden").addClass("ssi-canceledProgressBar");this.toUpload[a]=void 0;this.uploadList[a]=void 0;this.imgNames[a]=void 0;this.$element.find("#ssi-clearBtn").prop("disabled",!1);this.inProgress--;0===this.inProgress&&A(this)};var A=function(a){a.$element.find("#ssi-abortBtn").addClass("ssi-hidden");if(!a.options.preview){var c="error",e="",b="";0<a.abortedWithError?(e=1===a.totalFilesLength?a.errors:a.language.someErrorsOccurred,b='<span class="exclamation23"></span>'):
0<a.aborted&&0===a.successfulUpload?(b='<span class="ban23"></span>',e=a.language.aborted):0<a.successfulUpload&&(c="success",b='<span class="check23"></span>',e=a.language.sucUpload);a.$element.find(".ssi-namePreview").append(F(c,b,e,"ssi-noPreviewMessage"));a.$element.find("#ssi-uploadProgressNoPreview").removeAttr("styles").addClass("ssi-hidden")}if("function"===typeof a.options.onUpload)try{a.options.onUpload()}catch(d){console.log("There is an error in onUpload callback"),console.log(d)}a.$element.find("input.ssi-uploadInput").trigger("onUpload.ssi-uploader");
c=a.$element.find("#ssi-uploadBtn");a.$element.find("#ssi-clearBtn").prop("disabled",!1);c.prop("disabled",!1).find("#ssi-up_loading").empty();0===a.pending&&(c.addClass("ssi-hidden"),a.toUpload=[],a.imgNames=[],a.totalFilesLength=0);a.uploadList=[];a.totalProgress=[];a.currentListLength=a.inProgress+a.successfulUpload+a.aborted+a.abortedWithError+a.pending;a.successfulUpload=0;a.aborted=0;a.abortedWithError=0;a.inProgress=0};f.fn.ssi_uploader=function(a){var c=f.extend(!0,{url:"",data:{},locale:"en",
preview:!0,dropZone:!0,maxNumberOfFiles:"",responseValidation:!1,maxFileSize:2,ajaxOptions:{},onUpload:function(){},onEachUpload:function(){},beforeUpload:function(){},beforeEachUpload:function(){},allowed:["jpg","jpeg","png","bmp","gif"],errorHandler:{method:function(a){alert(a)},success:"success",error:"error"}},a);return this.each(function(){var a=f(this);if(a.is('input[type="file"]')){if(!a.data("ssi_upload")){var b=new k(this,c);a.data("ssi_upload",b)}}else console.log("The targeted element is not file input.")})};
String.prototype.replaceText=function(){for(var a=Array.apply(null,arguments),c=this,e=0;e<a.length;e++)c=c.replace("$"+(e+1),a[e]);return c};String.prototype.getExtension=function(){return this.split(".").pop().toLowerCase()};var u=function(a,c,e){"undefined"===typeof c&&(c="");"undefined"===typeof e&&(e=10);if(!(4>e)){var b=c.length;return a.length-2>e?(a=a.substring(0,e),a=a.substring(0,a.length-b),a+"..."+c):a}},G={en:{success:"Success",sucUpload:"Successful upload",chooseFiles:"Choose files",
uploadFailed:"Upload failed",serverError:"Internal server error",error:"Error",abort:"Abort",aborted:"Aborted",files:"files",upload:"Upload",clear:"Clear",drag:"Drag n Drop",sizeError:"$1 exceed the size limit of $2",extError:"$1 file types are not supported",someErrorsOccurred:"Some errors occurred!"},gr:{success:"\u0395\u03c0\u03b9\u03c4\u03c5\u03c7\u03af\u03b1",sucUpload:"\u0395\u03c0\u03b9\u03c4\u03c5\u03c7\u03ae\u03c2 \u03bc\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7",chooseFiles:"\u0395\u03c0\u03b9\u03bb\u03ad\u03be\u03c4\u03b5 \u03b1\u03c1\u03c7\u03b5\u03af\u03b1",
uploadFailed:"\u0397 \u03bc\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7 \u03b1\u03c0\u03ad\u03c4\u03c5\u03c7\u03b5!",serverError:"\u0395\u03c3\u03c9\u03c4\u03b5\u03c1\u03b9\u03ba\u03cc \u03c3\u03c6\u03ac\u03bb\u03bc\u03b1 \u03b4\u03b9\u03b1\u03ba\u03bf\u03bc\u03b9\u03c3\u03c4\u03ae!",error:"\u03a3\u03c6\u03ac\u03bb\u03bc\u03b1",abort:"\u0394\u03b9\u03b1\u03ba\u03bf\u03c0\u03ae",aborted:"\u0394\u03b9\u03b1\u03ba\u03cc\u03c0\u03b7\u03ba\u03b5",files:"\u03b1\u03c1\u03c7\u03b5\u03af\u03b1",
upload:"\u039c\u03b5\u03c4\u03b1\u03c6\u03cc\u03c1\u03c4\u03c9\u03c3\u03b7",clear:"\u0395\u03ba\u03ba\u03b1\u03b8\u03ac\u03c1\u03b9\u03c3\u03b7",drag:"\u03a3\u03c5\u03c1\u03b5\u03c4\u03b5 \u03b5\u03b4\u03ce...",sizeError:"$1 \u03ad\u03c7\u03b5\u03b9 \u03be\u03b5\u03c0\u03b5\u03c1\u03ac\u03c3\u03b5\u03b9 \u03c4\u03bf \u03cc\u03c1\u03b9\u03bf \u03c4\u03c9\u03bd $2.",extError:"$1 \u03b1\u03c1\u03c7\u03b5\u03af\u03b1 \u03b4\u03b5\u03bd \u03c5\u03c0\u03bf\u03c3\u03c4\u03b7\u03c1\u03af\u03b6\u03bf\u03bd\u03c4\u03b1\u03b9.",
someErrorsOccurred:"\u03a3\u03b7\u03bc\u03b5\u03b9\u03ce\u03b8\u03b7\u03ba\u03b1\u03bd \u03bf\u03c1\u03b9\u03c3\u03bc\u03ad\u03bd\u03b1 \u03bb\u03ac\u03b8\u03b7!"}}});
